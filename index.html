<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Med-AI Assistant | Medtools</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      width: 100%;
      overflow: hidden;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #000000;
    }

    /* Full screen iframe container */
    .iframe-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      border: none;
      z-index: 1;
    }

    /* Fallback loading screen */
    .loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #0a0a0a;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 2;
      transition: opacity 0.5s ease;
    }

    .loading-screen.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .loading-logo {
      width: 48px;
      height: 48px;
      background: #3b82f6;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 16px;
      animation: pulse 2s infinite;
    }

    .loading-text {
      color: #ffffff;
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .loading-subtitle {
      color: #888888;
      font-size: 14px;
    }

    .loading-dots {
      display: flex;
      gap: 4px;
      margin-top: 24px;
    }

    .loading-dot {
      width: 8px;
      height: 8px;
      background: #3b82f6;
      border-radius: 50%;
      animation: loading 1.4s infinite ease-in-out;
    }

    .loading-dot:nth-child(1) {
      animation-delay: -0.32s;
    }

    .loading-dot:nth-child(2) {
      animation-delay: -0.16s;
    }

    .loading-dot:nth-child(3) {
      animation-delay: 0s;
    }

    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
        opacity: 1;
      }
      50% {
        transform: scale(1.05);
        opacity: 0.8;
      }
    }

    @keyframes loading {
      0%, 80%, 100% {
        transform: scale(0.8);
        opacity: 0.5;
      }
      40% {
        transform: scale(1);
        opacity: 1;
      }
    }

    /* Error message */
    .error-message {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #1a1a1a;
      border: 1px solid #333333;
      border-radius: 12px;
      padding: 32px;
      text-align: center;
      color: #ffffff;
      z-index: 3;
      max-width: 400px;
      width: 90%;
      display: none;
    }

    .error-icon {
      width: 48px;
      height: 48px;
      background: #ef4444;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 16px;
    }

    .error-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .error-text {
      font-size: 14px;
      color: #888888;
      line-height: 1.5;
    }

    /* Mobile optimizations */
    @media (max-width: 768px) {
      .loading-text {
        font-size: 16px;
      }
      
      .loading-subtitle {
        font-size: 13px;
      }

      .error-message {
        padding: 24px;
        margin: 20px;
      }
    }

    /* High DPI displays */
    @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
      .iframe-container {
        transform: translateZ(0);
        backface-visibility: hidden;
        perspective: 1000;
      }
    }

    /* Prevent zoom on mobile */
    @media screen and (max-width: 768px) {
      .iframe-container {
        -webkit-transform: translateZ(0);
        -webkit-backface-visibility: hidden;
        -webkit-overflow-scrolling: touch;
      }
    }
  </style>
</head>
<body>
  <!-- Loading Screen -->
  <div class="loading-screen" id="loadingScreen">
    <div class="loading-logo">
      <svg width="24" height="24" fill="none" stroke="white" stroke-width="2" viewBox="0 0 24 24">
        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
      </svg>
    </div>
    <div class="loading-text">Med-AI Assistant</div>
    <div class="loading-subtitle">Loading your chat interface...</div>
    <div class="loading-dots">
      <div class="loading-dot"></div>
      <div class="loading-dot"></div>
      <div class="loading-dot"></div>
    </div>
  </div>

  <!-- Error Message -->
  <div class="error-message" id="errorMessage">
    <div class="error-icon">
      <svg width="24" height="24" fill="none" stroke="white" stroke-width="2" viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="15" y1="9" x2="9" y2="15"></line>
        <line x1="9" y1="9" x2="15" y2="15"></line>
      </svg>
    </div>
    <div class="error-title">Unable to Load</div>
    <div class="error-text">
      We're having trouble loading the chat interface. Please check your internet connection and try again.
    </div>
  </div>

  <!-- Main Chatbase Iframe -->
  <iframe 
    class="iframe-container"
    id="chatbaseIframe"
    src="https://www.chatbase.co/y7jTzyHhLeJFzUvlpBqqP/help"
    frameborder="0"
    allow="microphone; camera; geolocation"
    allowfullscreen
    sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox allow-presentation"
    title="Med-AI Assistant Chat Interface">
    
    <!-- Fallback content for browsers that don't support iframes -->
    <p>Your browser doesn't support iframes. Please use a modern browser to access the chat interface.</p>
  </iframe>

  <script>
    class ChatbaseEmbed {
      constructor() {
        this.iframe = document.getElementById('chatbaseIframe');
        this.loadingScreen = document.getElementById('loadingScreen');
        this.errorMessage = document.getElementById('errorMessage');
        this.isLoaded = false;
        
        this.init();
      }

      init() {
        // Handle iframe load events
        this.iframe.addEventListener('load', () => this.handleLoad());
        this.iframe.addEventListener('error', () => this.handleError());
        
        // Handle iframe access errors (X-Frame-Options)
        this.iframe.addEventListener('load', () => {
          try {
            // Test if we can access the iframe content
            this.iframe.contentWindow.location.href;
            this.isLoaded = true;
          } catch (e) {
            this.handleXFrameOptionsError();
          }
        });

        // Set a timeout for loading
        setTimeout(() => {
          if (!this.isLoaded) {
            this.handleError();
          }
        }, 10000); // 10 second timeout

        // Handle visibility change to maintain focus
        document.addEventListener('visibilitychange', () => {
          if (!document.hidden && this.isLoaded) {
            try {
              this.iframe.contentWindow.focus();
            } catch (e) {
              // Ignore cross-origin errors
            }
          }
        });

        // Handle window resize for mobile optimization
        window.addEventListener('resize', () => {
          this.handleResize();
        });

        // Initial resize
        this.handleResize();
      }

      handleLoad() {
        if (!this.isLoaded) {
          this.isLoaded = true;
          setTimeout(() => {
            this.hideLoading();
          }, 500); // Small delay for smooth transition
        }
      }

      handleError() {
        this.hideLoading();
        this.showError();
      }

      handleXFrameOptionsError() {
        this.hideLoading();
        this.showError();
      }

      hideLoading() {
        this.loadingScreen.classList.add('hidden');
        setTimeout(() => {
          this.loadingScreen.style.display = 'none';
        }, 500);
      }

      showError() {
        this.errorMessage.style.display = 'block';
      }

      handleResize() {
        // Ensure iframe takes full viewport on all devices
        const vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty('--vh', `${vh}px`);
        
        // Force iframe to fill screen on mobile
        if (window.innerWidth <= 768) {
          this.iframe.style.height = `${window.innerHeight}px`;
          this.iframe.style.width = `${window.innerWidth}px`;
        } else {
          this.iframe.style.height = '100vh';
          this.iframe.style.width = '100vw';
        }
      }
    }

    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        new ChatbaseEmbed();
      });
    } else {
      new ChatbaseEmbed();
    }

    // Handle page lifecycle for better mobile experience
    document.addEventListener('DOMContentLoaded', () => {
      // Prevent pull-to-refresh on mobile
      document.addEventListener('touchmove', (e) => {
        if (e.target.tagName !== 'IFRAME') {
          e.preventDefault();
        }
      }, { passive: false });

      // Handle orientation change
      window.addEventListener('orientationchange', () => {
        setTimeout(() => {
          window.scrollTo(0, 0);
        }, 100);
      });
    });
  </script>
</body>
</html>
